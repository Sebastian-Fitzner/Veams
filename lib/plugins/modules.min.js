!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("plugins/modules",[],t):"object"==typeof exports?exports["plugins/modules"]=t():(e["plugins/modules"]=e["plugins/modules"]||{},e["plugins/modules"]["plugins/modules"]=t())}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i={},s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.Veams,o=arguments[1];n(this,e),i=t,this.options=o,this._cache=[],this.modulesInContext=[],this.modulesRegister=[],this.modulesOnInit=[],this.modulesOnConditions=[],this.initialize()}return o(e,[{key:"initialize",value:function(){this.queryString="["+this.options.attrPrefix+"-module]",this.modulesInContext=i.helpers.querySelectorArray(this.queryString),this.options.useMutationObserver&&this.observe(document.body),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this;return i.Vent||this.options.useMutationObserver!==!1?void(i.Vent&&this.options.useMutationObserver===!1&&i.Vent.on(i.EVENTS.DOMchanged,function(t,n){e.modulesInContext=e.getModulesInContext(n),e.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",n),e.registerAll()})):void console.info('VeamsModules :: In order to work with the the ajax handling in VeamsModulesHandler you need to define "useMutationObserver" or use the VeamsVent plugin!')}},{key:"addToCache",value:function(e){this._cache.push(e),i.Vent&&i.Vent.trigger(i.EVENTS.moduleCached,{module:e.module,el:e.element})}},{key:"removeFromCacheByKey",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",n=void 0,o=0;o<this._cache.length;o++){var i=this._cache[o];i[t]===e&&(i.instance.willUnmount&&i.instance.willUnmount(),i.instance.unregisterEvents&&i.instance.unregisterEvents(),i.instance.didUnmount&&i.instance.didUnmount(),n=o)}n&&this._cache.splice(n,1)}},{key:"register",value:function(e){if(!Array.isArray(e))throw new Error("VeamsModules :: You need to pass an array to register()!");this.modulesRegister=this.modulesRegister.concat(e),this.splitUpModules(),this.bindConditions(),this.registerAll()}},{key:"registerAll",value:function(){this.modulesRegister&&(this.registerInitialModules(),this.registerConditionalModules())}},{key:"registerConditionalModules",value:function(){var e=this;this.modulesOnConditions.forEach(function(t){e.registerOne(t)})}},{key:"registerInitialModules",value:function(){var e=this;this.modulesOnInit.forEach(function(t){e.registerOne(t)})}},{key:"splitUpModules",value:function(){var e=this;this.modulesRegister.forEach(function(t){e.isCondition(t)?e.modulesOnConditions.push(t):e.modulesOnInit.push(t)})}},{key:"isCondition",value:function(e){return e.conditions&&"function"==typeof e.conditions}},{key:"makeConditionCheck",value:function(e){if(e.conditions&&"function"==typeof e.conditions)return e.conditions()}},{key:"checkModuleInCache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",n=!1;return this._cache.forEach(function(o){o[t]===e&&(n=!0)}),n}},{key:"checkModule",value:function(e){var t=!1;return this._cache.forEach(function(n){n.element===e&&(t=!0)}),t}},{key:"bindConditions",value:function(){var e=this;this.modulesOnConditions.forEach(function(t){t.conditionsListenOn&&t.conditionsListenOn.length&&e.registerCondition(t)})}},{key:"registerCondition",value:function(e){var t=this,n=e.conditionsListenOn.join(" ");i.Vent&&i.Vent.subscribe(n,function(){t.makeConditionCheck(e)?t.registerOne(e):t.unregisterOne(e)})}},{key:"registerOne",value:function(e){if(!e.domName)throw new Error("VeamsModules :: In order to work with register() you need to define the module name as string!");if(!e.module)throw new Error("VeamsModules :: In order to work with register() you need to define a module!");this.initModules(e)}},{key:"unregisterOne",value:function(e){this.checkModuleInCache(e.module,"module")===!0&&this.removeFromCacheByKey(e.module,"module")}},{key:"initModules",value:function(e){var t=this;i.helpers.forEach(this.modulesInContext,function(n,o){t.initModule(i.helpers.extend({el:o},e))})}},{key:"initModule",value:function(e){var t=e.el.getAttribute(this.options.attrPrefix+"-no-render")||e.render===!1||!1,n=e.el.getAttribute(this.options.attrPrefix+"-module").split(" ");if(n.indexOf(e.domName)!==-1){if(e.conditions&&"function"==typeof e.conditions&&e.conditions()!==!0)return;if(this.checkModule(e.el)===!0)return console.info("VeamsModules :: Element is already in cache and initialized: "),void console.log(e.el);var o=e.el.getAttribute("data-js-options"),s=i.helpers.extend(JSON.parse(o),e.options||{}),r=e.module,l=new r({el:e.el,namespace:e.domName,options:s});this.addToCache({element:e.el,module:e.module,instance:l,name:e.domName}),l.willMount&&l.willMount(),t||l.render(),e.cb&&"function"==typeof e.cb&&e.cb(l,s),l.didMount&&l.didMount()}}},{key:"observe",value:function(e){var t=this,n=new MutationObserver(function(e){for(var n=0;n<e.length;++n){for(var o=0;o<e[n].addedNodes.length;++o){var s=e[n].addedNodes[o];if(s instanceof HTMLElement){if(s.getAttribute(t.options.attrPrefix+"-module")){var r=s.getAttribute(t.options.attrPrefix+"-module");t.options.logs&&console.info("VeamsModules :: Recording new module: ",s,r);var l=!0,u=!1,d=void 0;try{for(var a,c=t.modulesRegister[Symbol.iterator]();!(l=(a=c.next()).done);l=!0){var h=a.value;if(h.domName===r){var f=i.helpers.extend({el:s},h);t.initModule(f);break}}}catch(m){u=!0,d=m}finally{try{!l&&c["return"]&&c["return"]()}finally{if(u)throw d}}}t.getModulesInContext(s).length&&(t.modulesInContext=t.getModulesInContext(s),t.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",s),t.registerAll())}}for(var v=0;v<e[n].removedNodes.length;++v){var g=e[n].removedNodes[v];if(g instanceof HTMLElement){if(g.getAttribute(t.options.attrPrefix+"-module")){var p=g.getAttribute(t.options.attrPrefix+"-module");t.options.logs&&console.info("VeamsModules :: Recording deletion of module: ",g,p),t.removeFromCacheByKey(g)}t.getModulesInContext(g).length&&(t.modulesInContext=t.getModulesInContext(g),t.options.logs&&console.info("VeamsModules :: Recording deletion of DOM element. When available modules will be unbound in ",g),t.modulesInContext.forEach(function(e){t.removeFromCacheByKey(e)}))}}}});n.observe(e,{childList:!0,subtree:!0})}},{key:"getModulesInContext",value:function(e){return i.helpers.querySelectorArray(this.queryString,e)}}]),e}(),r={options:{DEBUG:!1,attrPrefix:"data-js",logs:!1,useMutationObserver:!1},pluginName:"ModulesHandler",initialize:function(e,t){this.options=e.helpers.extend(this.options,t||{}),e.modules=e.modules||new s(e,this.options)}};t["default"]=r,e.exports=t["default"]}])});
//# sourceMappingURL=modules.min.js.map