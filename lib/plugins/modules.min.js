!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("plugins/modules",[],n):"object"==typeof exports?exports["plugins/modules"]=n():(e["plugins/modules"]=e["plugins/modules"]||{},e["plugins/modules"]["plugins/modules"]=n())}(this,function(){return function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i={},s=[],r={modulesInRegister:[],modulesOnConditions:[],modulesOnInit:[],modulesInContext:[]},l=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.Veams,o=arguments[1];t(this,e),i=n,this.options=o,this.options.internalCacheOnly||(this._cache=s),this.options.internalRegisterOnly||(this._register=r),this.initialize()}return o(e,[{key:"initialize",value:function(){this.queryString="["+this.options.attrPrefix+"-module]",r.modulesInContext=i.helpers.querySelectorArray(this.queryString),this.options.useMutationObserver&&this.observe(document.body),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this;return i.Vent||this.options.useMutationObserver!==!1?void(i.Vent&&this.options.useMutationObserver===!1&&i.Vent.on(i.EVENTS.DOMchanged,function(n,t){r.modulesInContext=e.getModulesInContext(t),e.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",t),e.registerAll()})):void console.info('VeamsModules :: In order to work with the the ajax handling in VeamsModulesHandler you need to define "useMutationObserver" or use the VeamsVent plugin!')}},{key:"checkModuleInCache",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",t=!1;return s.forEach(function(o){o[n]===e&&(t=!0)}),t}},{key:"bindConditions",value:function(){var e=this;r.modulesOnConditions.forEach(function(n){n.conditionsListenOn&&n.conditionsListenOn.length&&e.bindCondition(n)})}},{key:"bindCondition",value:function(e){var n=this,t=e.conditionsListenOn.join(" ");i.Vent&&i.Vent.subscribe(t,function(){n.registerConditionalModule(e)})}},{key:"splitUpModules",value:function(){var e=this;r.modulesInRegister.forEach(function(n){e.constructor.isCondition(n)?r.modulesOnConditions.push(n):r.modulesOnInit.push(n)})}},{key:"register",value:function(e){if(!Array.isArray(e))throw new Error("VeamsModules :: You need to pass an array to register()!");r.modulesInRegister=r.modulesInRegister.concat(e),this.splitUpModules(),this.bindConditions(),this.registerAll()}},{key:"registerAll",value:function(){r.modulesInRegister&&(this.registerInitialModules(),this.registerConditionalModules())}},{key:"registerInitialModules",value:function(){var e=this;r.modulesOnInit.forEach(function(n){e.registerOne(n)})}},{key:"registerConditionalModules",value:function(){var e=this;r.modulesOnConditions.forEach(function(n){e.registerConditionalModule(n)})}},{key:"registerConditionalModule",value:function(e){this.constructor.makeConditionCheck(e)?this.registerOne(e):this.unregisterOne(e)}},{key:"registerOne",value:function(e){if(!e.domName)throw new Error("VeamsModules :: In order to work with register() you need to define the module name as string!");if(!e.module)throw new Error("VeamsModules :: In order to work with register() you need to define a module!");this.initModules(e)}},{key:"unregisterOne",value:function(e){this.checkModuleInCache(e.module,"module")===!0&&this.constructor.removeFromCacheByKey(e.module,"module")}},{key:"initModules",value:function(e){var n=this;i.helpers.forEach(r.modulesInContext,function(t,o){n.initModule(i.helpers.extend({el:o},e))})}},{key:"initModule",value:function(e){var n=e.el.getAttribute(this.options.attrPrefix+"-no-render")||e.render===!1||!1,t=e.el.getAttribute(this.options.attrPrefix+"-module").split(" ");if(t.indexOf(e.domName)!==-1){if(this.checkModuleInCache(e.el)===!0)return console.info("VeamsModules :: Element is already in cache and initialized: "),void console.log(e.el);var o=e.el.getAttribute("data-js-options"),s=i.helpers.extend(JSON.parse(o),e.options||{}),r=e.module,l=new r({el:e.el,namespace:e.domName,options:s});this.constructor.addToCache({element:e.el,module:e.module,instance:l,name:e.domName}),l.willMount&&l.willMount(),n||l.render(),e.cb&&"function"==typeof e.cb&&e.cb(l,s),l.didMount&&l.didMount()}}},{key:"observe",value:function(e){var n=this,t=new MutationObserver(function(e){for(var t=0;t<e.length;++t){for(var o=0;o<e[t].addedNodes.length;++o){var s=e[t].addedNodes[o];if(s instanceof HTMLElement){if(s.getAttribute(n.options.attrPrefix+"-module")){var l=s.getAttribute(n.options.attrPrefix+"-module");n.options.logs&&console.info("VeamsModules :: Recording new module: ",s,l);var u=!0,d=!1,a=void 0;try{for(var c,f=r.modulesInRegister[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var m=c.value;if(m.domName===l){var h=i.helpers.extend({el:s},m);n.initModule(h);break}}}catch(g){d=!0,a=g}finally{try{!u&&f["return"]&&f["return"]()}finally{if(d)throw a}}}n.getModulesInContext(s).length&&(r.modulesInContext=n.getModulesInContext(s),n.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",s),n.registerAll())}}for(var v=0;v<e[t].removedNodes.length;++v){var p=e[t].removedNodes[v];if(p instanceof HTMLElement){if(p.getAttribute(n.options.attrPrefix+"-module")){var y=p.getAttribute(n.options.attrPrefix+"-module");n.options.logs&&console.info("VeamsModules :: Recording deletion of module: ",p,y),n.constructor.removeFromCacheByKey(p)}n.getModulesInContext(p).length&&(r.modulesInContext=n.getModulesInContext(p),n.options.logs&&console.info("VeamsModules :: Recording deletion of DOM element. When available modules will be unbound in ",p),r.modulesInContext.forEach(function(e){n.constructor.removeFromCacheByKey(e)}))}}}});t.observe(e,{childList:!0,subtree:!0})}},{key:"getModulesInContext",value:function(e){return i.helpers.querySelectorArray(this.queryString,e)}}],[{key:"addToCache",value:function(e){s.push(e),i.Vent&&i.Vent.trigger(i.EVENTS.moduleCached,{module:e.module,el:e.element})}},{key:"removeFromCacheByKey",value:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",t=void 0,o=0;o<s.length;o++){var i=s[o];i[n]===e&&(i.instance.willUnmount&&i.instance.willUnmount(),i.instance.unregisterEvents&&i.instance.unregisterEvents(),i.instance.didUnmount&&i.instance.didUnmount(),t=o)}t&&s.splice(t,1)}},{key:"isCondition",value:function(e){return e.conditions&&"function"==typeof e.conditions}},{key:"makeConditionCheck",value:function(e){if(e.conditions&&"function"==typeof e.conditions)return e.conditions()}}]),e}(),u={options:{DEBUG:!1,attrPrefix:"data-js",logs:!1,internalCacheOnly:!0,internalRegisterOnly:!1,useMutationObserver:!1},pluginName:"ModulesHandler",initialize:function(e,n){this.options=e.helpers.extend(this.options,n||{}),e.modules=e.modules||new l(e,this.options)}};n["default"]=u,e.exports=n["default"]}])});
//# sourceMappingURL=modules.min.js.map